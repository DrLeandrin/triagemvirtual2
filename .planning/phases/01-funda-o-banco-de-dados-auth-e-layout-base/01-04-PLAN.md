---
phase: 01-fundacao
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Patient can create account and login"
    - "Doctor can login"
    - "Protected routes redirect correctly"
    - "Database tables exist with correct schemas"
    - "Layouts render correctly for each role"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Phase 1 foundation works end-to-end: Supabase configured, database schema applied, authentication working for both patient and doctor, route protection enforcing role-based access, and layouts rendering correctly.

Purpose: Human verification ensures the foundation is solid before building features on top of it.
Output: Confirmed working foundation or list of issues to fix.
</objective>

<execution_context>
@C:\Users\leand\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\leand\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-funda-o-banco-de-dados-auth-e-layout-base/01-01-SUMMARY.md
@.planning/phases/01-funda-o-banco-de-dados-auth-e-layout-base/01-02-SUMMARY.md
@.planning/phases/01-funda-o-banco-de-dados-auth-e-layout-base/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify complete Phase 1 foundation</name>
  <what-built>
    Complete foundation for the Triagem Virtual application:
    1. Supabase client libraries (browser, server, middleware)
    2. Database schema with patients, doctors, consultations tables + RLS
    3. RBAC via Auth Hook injecting user_role into JWT claims
    4. Patient signup and login flows
    5. Route protection via proxy.ts with role-based redirects
    6. Patient layout (header navigation) and Doctor layout (sidebar navigation)
    7. Design system with medical-themed Tailwind tokens
  </what-built>
  <how-to-verify>
    **Pre-requisites (if not done already):**
    1. Ensure Supabase project is created and .env.local has real keys
    2. Run schema.sql in Supabase SQL Editor (Dashboard -> SQL Editor)
    3. Enable Auth Hook in Dashboard -> Authentication -> Hooks -> Custom Access Token -> select `public.custom_access_token_hook`
    4. To create a doctor account: manually insert into user_roles after signup with role='doctor'

    **Test as Patient:**
    1. Start dev server: `npm run dev`
    2. Visit http://localhost:3000 — should redirect to /login
    3. Click "Cadastre-se" link — should navigate to /signup
    4. Fill in: name, CPF (any 11 digits), email, password (6+ chars), confirm password
    5. Submit — should show success message about email confirmation
    6. Check email for confirmation link (or disable email confirmation in Supabase Dashboard for testing)
    7. After confirming, visit /login and log in with credentials
    8. Should redirect to /patient/dashboard
    9. Verify: header shows "Triagem Virtual", navigation links, "Sair" button
    10. Try accessing /doctor/dashboard directly — should redirect back to /patient/dashboard

    **Test as Doctor:**
    1. Create a new account via /signup (use different email)
    2. In Supabase Dashboard -> Table Editor -> user_roles: change the role from 'patient' to 'doctor' for this user
    3. Log out and log back in (token needs to refresh with new role)
    4. Should redirect to /doctor/dashboard
    5. Verify: sidebar shows "Triagem Virtual" + "Painel Medico", navigation items, "Sair" button
    6. Try accessing /patient/dashboard directly — should redirect to /doctor/dashboard

    **Test Route Protection:**
    1. Log out
    2. Try accessing /patient/dashboard — should redirect to /login
    3. Try accessing /doctor/dashboard — should redirect to /login

    **Visual Check:**
    1. Patient area: clean header layout, centered content, medical blue theme
    2. Doctor area: dark sidebar on left, light content area on right
    3. All text in Portuguese (pt-BR)
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 success criteria from ROADMAP.md:
- [ ] Paciente consegue criar conta e fazer login
- [ ] Medico consegue fazer login
- [ ] Rotas protegidas redirecionam corretamente
- [ ] Tabelas existem no Supabase com schemas corretos
</verification>

<success_criteria>
All four ROADMAP criteria verified by human testing.
</success_criteria>

<output>
After completion, create `.planning/phases/01-funda-o-banco-de-dados-auth-e-layout-base/01-04-SUMMARY.md`
</output>
